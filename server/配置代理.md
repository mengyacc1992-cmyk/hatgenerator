# 🔧 配置 Node.js 使用 VPN 代理

## 问题说明

虽然 VPN 已连接，浏览器可以访问 Google，但 Node.js 进程可能没有使用系统代理，导致无法访问 Gemini API。

## 解决方法

### 方法一：配置 VPN 全局代理（推荐）✨

**这是最简单的方法：**

1. **打开你的 VPN 软件设置**
2. **找到"代理模式"或"路由模式"选项**
3. **选择以下之一：**
   - "全局代理" / "Global Proxy"
   - "所有流量" / "All Traffic"
   - "系统代理" / "System Proxy"
4. **保存设置**
5. **重启后端服务：**
   ```bash
   # 在后端终端按 Ctrl + C 停止
   # 然后重新运行
   cd /Users/chengchi/yadamengisgenius-1/hatgenerator/server
   npm run dev
   ```

### 方法二：配置 Node.js 使用系统代理

如果你知道 VPN 的代理地址和端口：

1. **获取 VPN 代理信息**
   - 查看 VPN 软件的设置
   - 找到 HTTP/HTTPS 代理地址和端口
   - 例如：`127.0.0.1:1087` 或 `localhost:7890`

2. **在启动后端时设置环境变量**

   **方式 A：在终端设置（临时）**
   ```bash
   # 设置代理（替换为你的实际代理地址）
   export HTTP_PROXY=http://127.0.0.1:1087
   export HTTPS_PROXY=http://127.0.0.1:1087
   
   # 启动后端
   cd /Users/chengchi/yadamengisgenius-1/hatgenerator/server
   npm run dev
   ```

   **方式 B：在 .env 文件设置（永久）**
   
   编辑 `server/.env` 文件，添加：
   ```bash
   HTTP_PROXY=http://127.0.0.1:1087
   HTTPS_PROXY=http://127.0.0.1:1087
   ```
   
   （替换为你的实际代理地址）

3. **重启后端服务**

### 方法三：使用代理工具（高级）

如果你使用 Clash、V2Ray 等工具：

1. **确认代理工具正在运行**
2. **查看代理端口**（通常在设置中显示）
3. **按照方法二配置环境变量**

## 如何找到 VPN 代理地址

### 常见 VPN 软件的默认端口：

- **Clash**: `127.0.0.1:7890`
- **V2Ray**: `127.0.0.1:1080`
- **Shadowsocks**: `127.0.0.1:1080`
- **Surge**: `127.0.0.1:6152`
- **其他**: 查看 VPN 软件设置中的"本地端口"或"代理端口"

### 在 Mac 上查看系统代理：

1. 系统设置 → 网络 → 高级 → 代理
2. 查看 HTTP/HTTPS 代理设置
3. 记录服务器地址和端口

## 验证代理是否生效

### 测试 1：在终端测试
```bash
# 设置代理
export HTTPS_PROXY=http://127.0.0.1:7890

# 测试连接
curl https://generativelanguage.googleapis.com
```

如果能看到响应，说明代理配置成功。

### 测试 2：查看后端日志

启动后端后，尝试生成，查看终端是否还有网络错误。

## 常见问题

### Q: 不知道代理地址怎么办？
A: 
1. 查看 VPN 软件的设置/配置
2. 或者使用"全局代理"模式（方法一）

### Q: 设置了代理还是不行？
A: 
1. 确认 VPN 已连接
2. 确认代理地址和端口正确
3. 尝试重启 VPN 软件
4. 尝试切换 VPN 节点

### Q: 可以不用代理吗？
A: 
- 如果你不在中国大陆，可能不需要
- 如果在，通常需要 VPN 和代理

## 推荐方案

**最简单的方法：**
1. 打开 VPN 软件
2. 设置为"全局代理"模式
3. 重启后端服务
4. 再次尝试生成

这样 Node.js 进程就会自动使用 VPN 的代理了。
