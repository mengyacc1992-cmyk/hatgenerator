# 🌐 云平台部署完整流程（Vercel + Render）

## 📋 部署概览

- **前端**：部署到 Vercel（免费、快速、自动 HTTPS）
- **后端**：部署到 Render（免费、支持 Node.js、自动部署）

## 🎯 部署顺序

**重要**：先部署后端（Render），再部署前端（Vercel），因为前端需要知道后端地址。

```
1. 准备代码（推送到 GitHub）
   ↓
2. 部署后端到 Render
   ↓
3. 部署前端到 Vercel（使用 Render 的后端地址）
   ↓
4. 完成！
```

---

## 📝 第一步：准备代码

### 1.1 确保代码已推送到 GitHub

如果还没有，在终端运行：

```bash
cd /Users/chengchi/yadamengisgenius-1/hatgenerator

# 检查是否已初始化 Git
git status

# 如果没有，初始化并推送
git init
git add .
git commit -m "准备部署到云平台"
git remote add origin https://github.com/你的用户名/hatgenerator.git
git push -u origin main
```

### 1.2 准备 API Key

确保你有 Google Gemini API Key：
- 如果没有，去 https://aistudio.google.com/apikey 申请
- 记下这个 Key，部署时需要用到

---

## 🚀 第二步：部署后端到 Render

### 2.1 注册 Render

1. 打开 https://render.com
2. 用 GitHub 账号登录

### 2.2 创建 Web Service

1. 点击 **"New +"** → **"Web Service"**
2. 连接你的 `hatgenerator` 仓库
3. 配置如下：

**基本信息：**
- Name: `hatgenerator-backend`
- Region: `Singapore`（或离你最近的）
- Branch: `main`
- **Root Directory: `server`** ⚠️ 重要！

**构建和启动：**
- Build Command: `npm install && npm run build`
- Start Command: `npm start`

**环境变量：**
```
GEMINI_API_KEY=你的API_Key
NODE_ENV=production
PORT=10000
CORS_ORIGIN=https://你的vercel地址.vercel.app（先填临时值，后面更新）
```

### 2.3 等待部署完成

- 等待 5-10 分钟
- 看到 **"Live"** 状态表示成功
- **记下服务地址**，比如：`https://hatgenerator-backend.onrender.com`

### 2.4 测试后端

访问：`https://你的render地址.onrender.com/api/health`

应该看到：`{"status":"ok"}`

---

## 🌐 第三步：部署前端到 Vercel

### 3.1 注册 Vercel

1. 打开 https://vercel.com
2. 用 GitHub 账号登录

### 3.2 创建项目

1. 点击 **"Add New..."** → **"Project"**
2. 导入你的 `hatgenerator` 仓库

### 3.3 配置项目

**框架设置：**
- Framework Preset: `Vite`（自动检测）
- Root Directory: `.`（默认）
- Build Command: `npm run build`
- Output Directory: `dist`
- Install Command: `npm install`

**环境变量：**
```
VITE_API_BASE_URL=https://你的render地址.onrender.com
```

**重要**：这里要填第二步记下的 Render 后端地址！

### 3.4 开始部署

1. 点击 **"Deploy"**
2. 等待 2-3 分钟
3. 看到成功提示和网址

### 3.5 测试前端

1. 打开 Vercel 提供的网址
2. 尝试生成内容
3. 检查是否正常工作

---

## 🔧 第四步：更新配置（如果需要）

### 4.1 更新 Render 的 CORS 配置

如果前端地址和之前填的不一样：

1. 在 Render 服务页面
2. 点击 **"Environment"**（环境）
3. 更新 `CORS_ORIGIN` 为你的 Vercel 地址
4. 保存后会自动重新部署

### 4.2 更新 Vercel 的 API 地址

如果后端地址需要更新：

1. 在 Vercel 项目页面
2. 点击 **"Settings"** → **"Environment Variables"**
3. 更新 `VITE_API_BASE_URL`
4. 重新部署

---

## ✅ 部署完成检查

- [ ] 后端服务在 Render 上运行（状态为 Live）
- [ ] 后端健康检查通过（`/api/health` 返回 ok）
- [ ] 前端在 Vercel 上运行（可以访问）
- [ ] 前端可以正常调用后端 API
- [ ] 可以正常生成内容

---

## 🎉 完成！

现在你的应用已经部署到云端了！

**前端地址**：`https://你的项目.vercel.app`
**后端地址**：`https://你的项目.onrender.com`

---

## 📚 详细文档

- **Vercel 详细指南**：查看 `Vercel部署指南-小白版.md`
- **Render 详细指南**：查看 `Render部署指南-小白版.md`

---

## 🆘 遇到问题？

### 前端无法连接后端

1. 检查 `VITE_API_BASE_URL` 是否正确
2. 检查浏览器控制台（F12）的错误信息
3. 检查 Render 服务是否运行

### 后端 API 调用失败

1. 检查 `GEMINI_API_KEY` 是否正确
2. 检查 Render 日志中的错误信息
3. 检查 `CORS_ORIGIN` 是否匹配前端地址

### 部署失败

1. 查看构建日志中的错误信息
2. 确认配置是否正确
3. 参考详细部署指南

---

## 💡 小贴士

1. **自动部署**：每次推送代码到 GitHub，两个平台都会自动重新部署
2. **查看日志**：遇到问题先看日志，通常能找到原因
3. **免费版限制**：Render 免费版会休眠，首次访问可能较慢
4. **域名绑定**：可以在两个平台绑定自己的域名（需要配置 DNS）
