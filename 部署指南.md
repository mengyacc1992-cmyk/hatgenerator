# ğŸš€ éƒ¨ç½²æŒ‡å—

## éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šä¼ ç»Ÿéƒ¨ç½²ï¼ˆæ¨èç”¨äºå¼€å‘/æµ‹è¯•ï¼‰

#### 1. æ„å»ºé¡¹ç›®

**æ„å»ºåç«¯ï¼š**
```bash
cd server
npm install
npm run build
```

**æ„å»ºå‰ç«¯ï¼š**
```bash
npm install
npm run build
```

#### 2. é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡

**åç«¯é…ç½®** (`server/.env`):
```bash
GEMINI_API_KEY=ä½ çš„ç”Ÿäº§ç¯å¢ƒ_api_key
PORT=3001
NODE_ENV=production
CORS_ORIGIN=https://your-domain.com
HTTP_PROXY=http://proxy-server:port  # å¦‚æœéœ€è¦
HTTPS_PROXY=http://proxy-server:port  # å¦‚æœéœ€è¦
```

**å‰ç«¯é…ç½®** (`.env.production`):
```bash
VITE_API_BASE_URL=https://api.your-domain.com
```

#### 3. å¯åŠ¨æœåŠ¡

**åç«¯ï¼š**
```bash
cd server
npm start
```

**å‰ç«¯ï¼š**
```bash
npm run preview
```

æˆ–ä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰ï¼š
```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨åç«¯
cd server
pm2 start dist/index.js --name hatgenerator-backend

# å¯åŠ¨å‰ç«¯ï¼ˆéœ€è¦å…ˆæ„å»ºï¼‰
pm2 serve dist 3000 --name hatgenerator-frontend --spa
```

---

### æ–¹å¼äºŒï¼šDocker éƒ¨ç½²ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

#### 1. å‡†å¤‡ç¯å¢ƒå˜é‡

åˆ›å»º `server/.env` æ–‡ä»¶ï¼š
```bash
GEMINI_API_KEY=ä½ çš„_api_key
PORT=3001
NODE_ENV=production
CORS_ORIGIN=https://your-domain.com
```

#### 2. ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢
docker-compose down
```

#### 3. ä½¿ç”¨ Dockerï¼ˆå•ç‹¬éƒ¨ç½²ï¼‰

**æ„å»ºé•œåƒï¼š**
```bash
docker build -t hatgenerator:latest .
```

**è¿è¡Œå®¹å™¨ï¼š**
```bash
docker run -d \
  --name hatgenerator \
  -p 3001:3001 \
  --env-file server/.env \
  hatgenerator:latest
```

---

### æ–¹å¼ä¸‰ï¼šäº‘å¹³å°éƒ¨ç½²

#### Vercel / Netlifyï¼ˆå‰ç«¯ï¼‰

1. **è¿æ¥ GitHub ä»“åº“**
2. **é…ç½®æ„å»ºå‘½ä»¤ï¼š**
   - Build command: `npm run build`
   - Output directory: `dist`
3. **é…ç½®ç¯å¢ƒå˜é‡ï¼š**
   - `VITE_API_BASE_URL`: ä½ çš„åç«¯ API åœ°å€

#### Railway / Renderï¼ˆåç«¯ï¼‰

1. **è¿æ¥ GitHub ä»“åº“**
2. **é…ç½®æ„å»ºå‘½ä»¤ï¼š**
   - Build command: `cd server && npm install && npm run build`
   - Start command: `cd server && npm start`
3. **é…ç½®ç¯å¢ƒå˜é‡ï¼š**
   - `GEMINI_API_KEY`: ä½ çš„ API Key
   - `PORT`: 3001ï¼ˆæˆ–å¹³å°åˆ†é…çš„ç«¯å£ï¼‰
   - `CORS_ORIGIN`: ä½ çš„å‰ç«¯åœ°å€

---

## ç¯å¢ƒå˜é‡è¯´æ˜

### åç«¯ç¯å¢ƒå˜é‡

| å˜é‡å | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `GEMINI_API_KEY` | âœ… | Gemini API Key | `AIza...` |
| `PORT` | âŒ | æœåŠ¡ç«¯å£ | `3001` |
| `NODE_ENV` | âŒ | ç¯å¢ƒæ¨¡å¼ | `production` |
| `CORS_ORIGIN` | âŒ | å…è®¸çš„å‰ç«¯åœ°å€ | `https://your-domain.com` |
| `HTTP_PROXY` | âŒ | HTTP ä»£ç† | `http://127.0.0.1:10808` |
| `HTTPS_PROXY` | âŒ | HTTPS ä»£ç† | `http://127.0.0.1:10808` |
| `GEMINI_MODEL` | âŒ | ä½¿ç”¨çš„æ¨¡å‹ | `gemini-3-flash-preview` |

### å‰ç«¯ç¯å¢ƒå˜é‡

| å˜é‡å | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `VITE_API_BASE_URL` | âŒ | åç«¯ API åœ°å€ | `https://api.your-domain.com` |

---

## å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] API Key å·²é…ç½®ä¸”æœ‰æ•ˆ
- [ ] CORS é…ç½®æ­£ç¡®ï¼ˆç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨ `*`ï¼‰
- [ ] ç¯å¢ƒå˜é‡æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`
- [ ] ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPS
- [ ] ä»£ç†é…ç½®æ­£ç¡®ï¼ˆå¦‚æœéœ€è¦ï¼‰
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®
- [ ] æ—¥å¿—è®°å½•å·²é…ç½®

---

## ç›‘æ§å’Œç»´æŠ¤

### å¥åº·æ£€æŸ¥

è®¿é—® `/api/health` ç«¯ç‚¹æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š
```bash
curl https://api.your-domain.com/api/health
```

### æ—¥å¿—æŸ¥çœ‹

**PM2ï¼š**
```bash
pm2 logs hatgenerator-backend
```

**Dockerï¼š**
```bash
docker-compose logs -f backend
```

### é‡å¯æœåŠ¡

**PM2ï¼š**
```bash
pm2 restart hatgenerator-backend
```

**Dockerï¼š**
```bash
docker-compose restart backend
```

---

## æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨
- æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
- æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶

### API è°ƒç”¨å¤±è´¥
- æ£€æŸ¥ API Key æ˜¯å¦æœ‰æ•ˆ
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æ£€æŸ¥ä»£ç†é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰

### CORS é”™è¯¯
- æ£€æŸ¥ `CORS_ORIGIN` é…ç½®
- ç¡®è®¤å‰ç«¯åœ°å€ä¸é…ç½®ä¸€è‡´

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨ CDN**ï¼šå°†å‰ç«¯é™æ€èµ„æºéƒ¨ç½²åˆ° CDN
2. **å¯ç”¨ç¼“å­˜**ï¼šé…ç½®é€‚å½“çš„ç¼“å­˜ç­–ç•¥
3. **è´Ÿè½½å‡è¡¡**ï¼šå¦‚æœæµé‡å¤§ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡
4. **ç›‘æ§**ï¼šè®¾ç½®ç›‘æ§å’Œå‘Šè­¦

---

## å¿«é€Ÿéƒ¨ç½²å‘½ä»¤

```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy.sh

# æˆ–æ‰‹åŠ¨éƒ¨ç½²
cd server && npm install && npm run build && npm start
npm install && npm run build && npm run preview
```
